<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>

    <link rel="stylesheet" href="css/style.css">

    <link rel="icon" href="img/icon.jpg">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.js"></script>

    <script>
        "use strict";
        function pageLoad(){
            console.log("Invoked pageLoad()");
            getRecordList();
            //getAchievementList();  commented because you don't have an API method for this yet
        }

        function logout(){
            console.log("logout - remove cookies and redirect to login page");
            Cookies.remove("sessionToken");
            window.location.href = "login.html";
        }


        function getRecordList(){
            console.log("Invoked getRecordList()");
            var url = "/record/list";

            fetch(url, {
                method: "GET"}).then(response => {
                return response.json();
            }).then (response => {
                if (response.hasOwnProperty("Error")) {
                    alert(JSON.stringify(response));
                } else {
                    formatRecords(response);
                };
            });
        }

        function getAchievementList(){
            console.log("Invoked getAcheivementList()");

            var url = "/achievement/list";

            fetch(url, {method: "GET"}).then( response => {
                return response.json();
            }).then (response => {
                if (response.hasOwnProperty("Error")) {
                    alert(JSON.stringify(response));
                } else {
                    console.log(response);
                    refreshAchievementTable(response);
                };
            });
        }

        function formatRecords(response){
            console.log(response);

            let dataHTML = "<tr><td>Record Date</td><td>Choice ID </td><td>Choice Name</td></tr>";

            for (let item of response) {
                dataHTML += "<tr><td>" + item.RecordDate + "</td><td>" + item.ChoiceId + "</td><td>"
                    + item.ChoiceName + "</td></tr>";               }
            document.getElementById("tblRecords").innerHTML = dataHTML;



        }

        function refreshAchievementTable(response){
            removeAllAchievementRows(name);
            for (let id in response){
                addTableAchievementRow(name, id, response[id]);
            }
        }

        function removeAllRecordRows(name) {
            var tblObject = document.getElementById(name);
            // Remove any existing rows except for the title row
            tblObject.removeChild(tblObject.getElementsByTagName("tbody")[0]);
            var tblBody = document.createElement("tbody");
            tblObject.appendChild(tblBody);
        }

        function removeAllAchievementRows(name) {
            var tblObject = document.getElementById(name);
            // Remove any existing rows except for the title row
            tblObject.removeChild(tblObject.getElementsByTagName("tbody")[0]);
            var tblBody = document.createElement("tbody");
            tblObject.appendChild(tblBody);
        }

        function addTableRecordRow(name, id, jsonElements){
            var tblObject = document.getElementById(name);
            var tblBody = tblObject.getElementsByTagName("tbody")[0];
            var tblRow = tblBody.insertRow();
            tblRow.insertCell(0).innerHTML = id;
            tblRow.insertCell(1).innerHTML = jsonElements["UserId"];
            tblRow.insertCell(2).innerHTML = jsonElements["RecordDate"];
            tblRow.insertCell(3).innerHTML = jsonElements["ChoiceId"];
            tblRow.insertCell(4).innerHTML = jsonElements["ChoiceName"];
        }

        function addTableAchievementRow(name, id, jsonElements){
            var tblObject = document.getElementById(name);
            var tblBody = tblObject.getElementsByTagName("tbody")[0];
            var tblRow = tblBody.insertRow();
            tblRow.insertCell(0).innerHTML = jsonElements["AchievementDate"];
            tblRow.insertCell(1).innerHTML = jsonElements["AchievementName"];
        }




    </script>


</head>
<body onload="pageLoad()">
<div class="topnav">
    <a class="active" href="profile.html">Profile</a>
    <a class="a" href="question1.html">Questionnaire</a>
    <a class="a" href="progressGraph.html">Progress</a>
    <div class="topnav-centered">
        <a class="a" href="index.html">Mentality</a>
    </div>
    <div class="topnav-right">
        <a class="a" onclick="logout()">Logout</a>
    </div>
    <input type="text" placeholder="Search..">
</div>

<br>

<div class="row">
    <div>
        <section>
            <h2>Records</h2>
            <table id="tblRecords" class="recordList">

            </table>

        </section>

        <section>
            <h2>Achievements</h2>
            <table id="achievementList" class="achievementList">
                <thead>
                <tr>
                    <th>Date</th>
                    <th>Achievement</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>

        </section>
    </div>
</div>
</body>
</html>